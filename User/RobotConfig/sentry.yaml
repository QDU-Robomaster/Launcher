global_settings:
  monitor_sleep_ms: 1000
modules:
- id: blink_led
  name: BlinkLED
  constructor_args:
    blink_cycle: 250
- id: cmd
  name: CMD
  constructor_args:
    mode: CMD::Mode::CMD_OP_CTRL
    chassis_cmd_topic_name: chassis_cmd
    gimbal_cmd_topic_name: gimbal_cmd
    launcher_cmd_topic_name: launcher_cmd
- id: dr16
  name: DR16
  constructor_args:
    CMD: '@cmd'
    task_stack_depth_uart: 2048
    cmd_data_tp_name: cmd_raw_data_
- id: bmi088
  name: BMI088
  constructor_args:
    gyro_freq: BMI088::GyroFreq::GYRO_2000HZ_BW532HZ
    accl_freq: BMI088::AcclFreq::ACCL_1600HZ
    gyro_range: BMI088::GyroRange::DEG_2000DPS
    accl_range: BMI088::AcclRange::ACCL_24G
    rotation:
      w: 1.0
      x: 0.0
      y: 0.0
      z: 0.0
    pid_param:
      k: 1.0
      p: 0.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    gyro_topic_name: bmi088_gyro
    accl_topic_name: bmi088_accl
    target_temperature: 45
    task_stack_depth: 2048
    camera_sync_pin_name: CAMERA
    camera_sync_div: 10
- id: ahrs
  name: MadgwickAHRS
  constructor_args:
    beta: 0.05
    gyro_topic_name: imu_gyro
    accl_topic_name: imu_accl
    quaternion_topic_name: ahrs_quaternion
    euler_topic_name: ahrs_euler
    task_stack_depth: 2048
- id: hostdata
  name: HostData
  constructor_args:
    cmd: '@cmd'
    host_euler_topic_name: target_eulr
    host_chassis_data_topic_name: host_chassis_data
    host_fire_topic_name: host_fire_notify
- id: sharetopic
  name: SharedTopic
  constructor_args:
    uart_name: usb_otg_hs_cdc
    task_stack_depth: 2048
    buffer_size: 256
    topic_configs:
    - target_euler
    - chassis_data
    - fire_notify
- id: super_power
  name: SuperPower
  constructor_args:
    can_bus_name: can2
    task_stack_depth: 2048
- id: power_control
  name: PowerControl
  constructor_args:
    superpower: '@&super_power'
    is_helm: 'false'
- id: motor_yaw
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: true
      feedback_id: 522
      can_bus_name: can1
- id: motor_pit
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 521
      can_bus_name: can2
- id: gimbal
  name: Gimbal
  constructor_args:
    cmd: '@cmd'
    task_stack_depth: 4096
    pid_yaw_angle_param:
      k: 1.0
      p: 50.0
      i: 2.0
      d: 0.0
      i_limit: 0.0
      out_limit: 50.0
      cycle: true
    pid_pitch_angle_param:
      k: 1.0
      p: 30.0
      i: 2.0
      d: 0.0
      i_limit: 0.0
      out_limit: 2.5
      cycle: false
    pid_yaw_omega_param:
      k: 1.0
      p: 0.3
      i: 0.005
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_pitch_omega_param:
      k: 1.0
      p: 0.3
      i: 0.1
      d: 0.0
      i_limit: 0.0
      out_limit: 2.5
      cycle: false
    motor_pitch: '@&motor_pit'
    motor_yaw: '@&motor_yaw'
    limit:
      max_pitch_angle_: 4.2
      min_pitch_angle_: 3.85
      max_yaw_angle_: 0.0
      min_yaw_angle_: 0.0
      reverse_pitch_: false
      reverse_yaw_: false
      J_pitch_: 0.0
      J_yaw_: 0.0
    gimbal_cmd_topic_name: gimbal_cmd
    accl_topic_name: bmi088_accl
    euler_topic_name: ahrs_euler
- id: motor_wheel_0
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: false
      feedback_id: 513
      can_bus_name: can2
- id: motor_wheel_1
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: false
      feedback_id: 514
      can_bus_name: can2
- id: motor_wheel_2
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: false
      feedback_id: 515
      can_bus_name: can2
- id: motor_wheel_3
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: false
      feedback_id: 516
      can_bus_name: can2
- id: motor_steer_0
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 517
      can_bus_name: can1
- id: motor_steer_1
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 518
      can_bus_name: can1
- id: motor_steer_2
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 519
      can_bus_name: can1
- id: motor_steer_3
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 520
      can_bus_name: can1
- id: helm_chassis
  name: Chassis
  constructor_args:
    motor_wheel_0: '@&motor_wheel_0'
    motor_wheel_1: '@&motor_wheel_1'
    motor_wheel_2: '@&motor_wheel_2'
    motor_wheel_3: '@&motor_wheel_3'
    motor_steer_0: '@&motor_steer_0'
    motor_steer_1: '@&motor_steer_1'
    motor_steer_2: '@&motor_steer_2'
    motor_steer_3: '@&motor_steer_3'
    cmd: '@&cmd'
    power_control: '@&power_control'
    task_stack_depth: 2048
    ChassisParam:
      wheel_radius: 0.063
      wheel_to_center: 0.31
      gravity_height: 0.0
      reductionratio: 15.7647
      wheel_resistance: 0.0
      error_compensation: 0.0
    pid_follow:
      k: 0.15
      p: 30.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_velocity_x_:
      k: 0.0015
      p: 14.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_velocity_y_:
      k: 0.0015
      p: 14.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_omega_:
      k: 0.15
      p: 30.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_wheel_angle_0_:
      k: 0.0001
      p: 5.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_wheel_angle_1_:
      k: 0.0001
      p: 5.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_wheel_angle_2_:
      k: 0.0001
      p: 5.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_wheel_angle_3_:
      k: 0.0001
      p: 5.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_steer_angle_0_:
      k: 1.0
      p: 50.0
      i: 1.5
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_steer_angle_1_:
      k: 1.0
      p: 50.0
      i: 1.5
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_steer_angle_2_:
      k: 1.0
      p: 50.0
      i: 1.5
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_steer_angle_3_:
      k: 1.0
      p: 50.0
      i: 1.5
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    pid_steer_speed_0_:
      k: 1.0
      p: 0.03
      i: 0.03
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_steer_speed_1_:
      k: 1.0
      p: 0.025
      i: 0.04
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_steer_speed_2_:
      k: 1.0
      p: 0.025
      i: 0.04
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_steer_speed_3_:
      k: 1.0
      p: 0.025
      i: 0.04
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
  template_args:
    ChassisType: Helm
- id: motor_trig
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M2006
      reverse: false
      feedback_id: 513
      can_bus_name: can1
- id: motor_fric_0
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: true
      feedback_id: 520
      can_bus_name: can2
- id: motor_fric_1
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_M3508
      reverse: false
      feedback_id: 519
      can_bus_name: can2
- id: launcher
  name: Launcher
  constructor_args:
    motor_fric_front_left: '@&motor_fric_0'
    motor_fric_front_right: '@&motor_fric_1'
    motor_fric_back_left: '@nullptr'
    motor_fric_back_right: '@nullptr'
    motor_trig: '@&motor_trig'
    task_stack_depth: 2048
    pid_trig_angle:
      k: 1.0
      p: 35.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 30.0
      cycle: false
    pid_trig_speed:
      k: 1.0
      p: 0.65
      i: 0.8
      d: 0.0
      i_limit: 0.0
      out_limit: 0.5
      cycle: false
    pid_fric_speed_0:
      k: 1.0
      p: 0.002
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 1.0
      cycle: false
    pid_fric_speed_1:
      k: 1.0
      p: 0.002
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 1.0
      cycle: false
    pid_fric_speed_2:
      k: 0.0
      p: 0.002
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 1.0
      cycle: false
    pid_fric_speed_3:
      k: 0.0
      p: 0.002
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 1.0
      cycle: false
    launcher_param:
      fric1_setpoint_speed: 3500.0
      fric2_setpoint_speed: 0.0
      default_bullet_speed: 0.0
      fric_radius: 0.03
      trig_gear_ratio: 36.0
      num_trig_tooth: 10
      trig_freq_: 20.0
    cmd: '@&cmd'
  template_args:
    LauncherType: InfantryLauncher
- id: client_topic
  name: SharedTopicClient
  constructor_args:
    uart_name: usb_otg_hs_cdc
    task_stack_depth: 2048
    buffer_size: 256
    topic_configs:
    - ahrs_quaternion
    - - topic2
      - libxr_def_domain
- id: event_binder
  name: EventBinder
  constructor_args:
    modules:
    - name: dr16
      module_ref: '@dr16'
    - name: cmd
      module_ref: '@cmd'
    - name: chassis
      module_ref: '@helm_chassis'
    - name: gimbal
      module_ref: '@gimbal'
    - name: launcher
      module_ref: '@launcher'
    event_binding_groups:
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_MID
        target_module: cmd
        target_event: CMD::Mode::CMD_OP_CTRL
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_BOT
        target_module: cmd
        target_event: CMD::Mode::CMD_AUTO_CTRL
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_TOP
        target_module: chassis
        target_event: ChassisEvent::SET_MODE_RELAX
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_MID
        target_module: chassis
        target_event: ChassisEvent::SET_MODE_FOLLOW
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_TOP
        target_module: gimbal
        target_event: Gimbal<RMMotor, RMMotor>::GimbalEvent::SET_MODE_RELAX
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_MID
        target_module: gimbal
        target_event: Gimbal<RMMotor, RMMotor>::GimbalEvent::SET_MODE_INDEPENDENT
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_TOP
        target_module: launcher
        target_event: LauncherEvent::SET_MODE_RELAX
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_MID
        target_module: launcher
        target_event: LauncherEvent::SET_MODE_SAFE
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_L_POS_BOT
        target_module: launcher
        target_event: LauncherEvent::SET_MODE_READY
  template_args:
    ChassisType: Helm
- id: testlauncher
  name: TestLauncher
  constructor_args:
    task_stack_depth: 2048
    cmd: '@&cmd'
    pid_param_trig_angle:
      k: 1.0
      p: 20.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_param_trig_speed:
      k: 1.0
      p: 0.2
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_param_fric_0:
      k: 1.0
      p: 2.0e-06
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    pid_param_fric_1:
      k: 1.0
      p: 2.0e-06
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    motor_fric_0: '@&motor_fric_0'
    motor_fric_1: '@&motor_fric_1'
    motor_trig: '@&motor_trig'
    launcher_param:
      fric_rpm: 5000
      trig_gear_ratio: 0.0
      num_trig_tooth: 0
      trig_freq_: 0.0
